<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=375, initial-scale=1.0">
<title>Mobile Poster Creator</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/cropperjs@1.5.13/dist/cropper.min.css" rel="stylesheet">
<style>
  @font-face {
    font-family: 'CenturyExpanded';
    src: url('CenturyExpanded-Bold.ttf') format('truetype');
    font-weight: bold;
    font-style: normal;
  }
  body { margin:0; padding:0; font-family: Arial,sans-serif; background:#f4f4f4; display:flex; flex-direction:column; align-items:center; }
  .container { width:375px; padding:1rem; box-sizing:border-box; }
  input, button { width:100%; padding:0.75rem; margin-bottom:1rem; font-size:1rem; border:1px solid #ccc; border-radius:6px; }
  button { background-color:#007bff; color:white; border:none; cursor:pointer; }
  #shareBtn { background-color:#25D366; }
  .poster-container { position:relative; width:375px; height:667px; margin:1rem auto; background:url('final.jpg') no-repeat center center; background-size:100% 100%; overflow:hidden; border:2px solid #ccc; }
  .circle-photo { position:absolute; top:45.7%; left:50%; width:210px; height:210px; transform:translate(-50%,-50%); border-radius:50%; overflow:hidden; background:#ccc; }
  .circle-photo img { width:100%; height:100%; object-fit:cover; }
  .name-overlay { position:absolute; bottom:188px; left:50%; transform:translateX(-50%); color:#ffee00; font-size:35px; text-align:center; text-shadow:2px 2px 5px rgba(0,0,0,0.8); font-family:'CenturyExpanded',serif; font-weight:bold; width:100%; }
  #captionInput { margin-top:0; margin-bottom:1rem; }
  #cropModal { position:fixed; inset:0; background:rgba(0,0,0,0.8); display:none; align-items:center; justify-content:center; z-index:1000; }
  #cropModal .modal-content { background:white; padding:1rem; position:relative; max-width:90%; }
  #cropImage { max-width:100%; max-height:400px; display:block; margin:0 auto; }
  .overlay-circle { position:absolute; top:50%; left:50%; width:200px; height:200px; transform:translate(-50%,-50%); border-radius:50%; box-shadow:0 0 0 9999px rgba(0,0,0,0.5); pointer-events:none; }
  .buttons { margin-top:1rem; display:flex; gap:1rem; justify-content:flex-end; }
</style>
</head>
<body>
<div class="container">
  <input type="text" id="firstName" placeholder="First Name" required="">
  <input type="text" id="lastName" placeholder="Last Name" required="">
  <input type="file" id="photoInput" accept="image/*" required="">
  <input type="text" id="captionInput" placeholder="Enter caption for WhatsApp" value="🙏 Satam Cho Ane — Join us in the celebration!">

  <div class="poster-container" id="poster">
    <div class="circle-photo" id="photoPreview"></div>
    <div class="name-overlay" id="nameOverlay">Your Name</div>
  </div>

  <button id="downloadBtn">Download Poster</button>
  <button id="shareBtn">Share on WhatsApp</button>
</div>

<div id="cropModal">
  <div class="modal-content">
    <div class="overlay-circle"></div>
    <img id="cropImage">
    <div class="buttons">
      <button id="cropBtn">Crop</button>
      <button id="cancelBtn">Cancel</button>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/cropperjs@1.5.13/dist/cropper.min.js"></script>
<script>
const firstNameInput=document.getElementById('firstName');
const lastNameInput=document.getElementById('lastName');
const nameOverlay=document.getElementById('nameOverlay');
const photoInput=document.getElementById('photoInput');
const photoPreview=document.getElementById('photoPreview');
const downloadBtn=document.getElementById('downloadBtn');
const shareBtn=document.getElementById('shareBtn');
const captionInput=document.getElementById('captionInput');
const cropModal=document.getElementById('cropModal');
const cropImage=document.getElementById('cropImage');
const cropBtn=document.getElementById('cropBtn');
const cancelBtn=document.getElementById('cancelBtn');

let cropper, croppedImageDataURL=null, latestPosterBlob=null;

// update name overlay
function updateName(){
  const fn=firstNameInput.value.trim();
  const ln=lastNameInput.value.trim();
  nameOverlay.textContent=(fn||ln)?`${fn} ${ln}`.trim():'Your Name';
}
firstNameInput.addEventListener('input',updateName);
lastNameInput.addEventListener('input',updateName);

// photo crop
photoInput.addEventListener('change', e=>{
  const file=e.target.files[0];
  if(!file||!file.type.startsWith('image/')) return;
  const reader=new FileReader();
  reader.onload=ev=>{
    cropImage.src=ev.target.result;
    cropModal.style.display='flex';
    cropImage.onload=()=>{
      cropper?.destroy();
      cropper=new Cropper(cropImage,{
        aspectRatio:1, viewMode:1, dragMode:'move', guides:false, background:false,
        cropBoxResizable:false, cropBoxMovable:false
      });
    };
  };
  reader.readAsDataURL(file);
});

cropBtn.addEventListener('click',()=>{
  if(!cropper) return;
  const canvas=cropper.getCroppedCanvas({width:400,height:400});
  croppedImageDataURL=canvas.toDataURL();
  photoPreview.innerHTML=`<img src="${croppedImageDataURL}"/>`;
  cropper.destroy();
  cropModal.style.display='none';
});
cancelBtn.addEventListener('click',()=>{cropper?.destroy(); cropModal.style.display='none';});

// generate poster
async function generatePosterBlob(callback){
  if(!croppedImageDataURL){alert('Please upload and crop your photo first.'); return;}
  const name=nameOverlay.textContent||'Your Name';
  const canvas=document.createElement('canvas');
  canvas.width=1080; canvas.height=1920;
  const ctx=canvas.getContext('2d');

  const background=new Image();
  background.crossOrigin='anonymous';
  background.src='final.jpg';
  background.onload=()=>{
    ctx.drawImage(background,0,0,1080,1920);
    const photo=new Image();
    photo.crossOrigin='anonymous';
    photo.src=croppedImageDataURL;
    photo.onload=()=>{
      const size=605;
      const x=(1080-size)/2;
      const y=877-(size/2);
      ctx.save(); ctx.beginPath();
      ctx.arc(x+size/2,y+size/2,size/2,0,Math.PI*2);
      ctx.closePath(); ctx.clip();
      ctx.drawImage(photo,x,y,size,size);
      ctx.restore();

      try{ document.fonts.load('bold 20px CenturyExpanded').then(()=>{}); } catch{}
      // name overlay
      let maxWidth=1000,maxFontSize=145,fontSize=20;
      while(fontSize<maxFontSize){ ctx.font=`bold ${fontSize+1}px 'CenturyExpanded',serif`; if(ctx.measureText(name).width>maxWidth) break; fontSize++; }
      ctx.font=`bold ${fontSize}px 'CenturyExpanded',serif`;
      ctx.fillStyle='#ffee00'; ctx.textAlign='center'; ctx.shadowColor='rgba(0,0,0,0.8)'; ctx.shadowBlur=6;
      ctx.fillText(name,1080/2,1360);

      canvas.toBlob(blob=>{
        latestPosterBlob=blob;
        if(callback) callback(blob);
      },'image/png');
    };
  };
}

// download poster
downloadBtn.addEventListener('click',()=>{generatePosterBlob(blob=>{
  const link=document.createElement('a');
  link.href=URL.createObjectURL(blob);
  link.download='custom-poster.png';
  document.body.appendChild(link);
  link.click(); link.remove();
  URL.revokeObjectURL(link.href);
});});

// share poster
shareBtn.addEventListener('click',()=>{generatePosterBlob(async blob=>{
  const file=new File([blob],'poster.png',{type:'image/png'});
  const captionText=captionInput.value || '';
  // copy caption to clipboard
  navigator.clipboard.writeText(captionText).then(()=>{ console.log('Caption copied'); }).catch(()=>{});
  if(navigator.canShare && navigator.canShare({files:[file]})){
    try{ await navigator.share({files:[file],title:'My Poster'}); }catch(err){console.error(err);}
  }else{
    alert('Sharing not supported. Image downloaded. Caption copied to clipboard:\n\n'+captionText);
    const link=document.createElement('a');
    link.href=URL.createObjectURL(blob);
    link.download='custom-poster.png';
    document.body.appendChild(link); link.click(); link.remove();
    URL.revokeObjectURL(link.href);
  }
});});
</script>
</body>
</html>
